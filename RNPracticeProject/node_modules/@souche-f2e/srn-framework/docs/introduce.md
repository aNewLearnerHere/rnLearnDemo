# 特性介绍

srn-framework 包含以下核心功能：

## SRNApp 应用入口

SRNApp 核心功能：

* 初始化应用的 router 和 默认入口
* 初始化 sentry
* 注册应用

初始化完成后，应用就会默认调用入口 route 的页面，开始应用逻辑。

内部核心集成了一个独立封装过的 srn-navigator 的包，这个包提供整个应用 router 管理、 navigator 标题栏的配置管理、应用视图栈管理等。

## SRNConfig 配置管理

SRNConfig 用来管理整个应用相关的配置，它包含两个部分：默认配置信息 和 自定义配置。

默认配置内部包含应用的一些信息和状态。

例如：

```javascript
SRNConfig.env         //当前的环境，枚举 ENV_DEV、ENV_PREPUB、ENV_PROD
SRNConfig.hostAppName //宿主 app 的appName，枚举 APPNAME_CHENIU、APPNAME_DAFENGCHE、APPNAME_TANGECHE
SRNConfig.platform    //当前的平台环境，枚举 PLATFORM_IOS、PLATFORM_ANDROID
SRNConfig.appScheme   //宿主 app 的 scheme 协议头
SRNConfig.ua          //生成的 ua ，可以直接用在各种请求的 header 中
SRNConfig.appVersion  //宿主 app 的 版本号
```

自定义配置可以在应用初始化之前手动载入

```javascript
/**
 * 加载初始化配置（各个环境）
 */
SRNConfig.load({
    default: require('../config/default.config').default,
    dev: require('../config/dev.config').default,
    prepub: require('../config/prepub.config').default,
    prod: require('../config/prod.config').default
});
```

default 是默认配置，通常包含几个必须的配置

```
const packageJSON = require('../../package.json');

export default {
    appName: 'framework',            // 应用名
    appVersion: packageJSON.version, // 应用版本号
    sentry: {                        // Sentry 配置
        version: packageJSON.version,
        dsn: ''
    }
}
```
其他配置会根据环境自动选择，并与 default 的默认配置合并。

## SRNPage 页面定义

应用内所有的独立页面都应该继承自 SRNPage 这个父类。

SRNPage 主要提供以下几个功能：

* 标题栏的定义 navigation
* 当前页面的 route 信息，包括 path，referrer，params 等
* 打开H5，原生协议，RN 页面的功能：this.open()
* 几个新的生命周期 viewDidLoad viewDidAppear viewDidDisappear dealloc

关于 navigation 的用法参见：http://fedoc.sqaproxy.souche.com/#/rn/develop/dev_3

## SRNStore viewModel 层

目前主要提供一个 __fetch 的封装，封装网络请求中需要关心的 header 和 错误处理等。

```javascript

/**
 * 此处定义页面数据管理层，业务复杂请分文件夹
 */

import { SRNStore } from '@souche-f2e/srn-framework';s
// 引入model定义，一个页面应该对应一个store，页面内的数据对象则应该定义为model
import CarModel from '../models/CarModel';

class IndexStore extends SRNStore {
    recommendCar = new CarModel();

    constructor () {
        super();
    }

    /**
     * 请求数据
     */
    fetch () {
        // 调用父类的方法发起请求
        this.__fetch('http://niu.souche.com/car/E3mzQRagdT').then((data) => {
            this.recommendCar.__map(data.data);
        }).catch((e) => {
            // 请求失败，e.message 是后台返回的message，e.code 是后台返回的错误码
        });
    }
}

export default IndexStore;

```

## SRNModel 数据实体定义及验证

SRNModel 核心提供两个功能：数据映射 和 数据校验。

使用：

```javascript
var carModel = new CarModel();
carModel.__map({
    title:'车辆标题',
    price: '20_$kw'
})
console.log(carModel);
```

内置一个 __map 方法，会根据 model 的定义 和 参数给予的数据自动将数据映射到当前实例上。

在定义的时候，注意有几个装饰器可用，分别为：

```
@Unit         // 单位声明和转换，需与服务端配合。
@Check        // 类型检查，如果赋值类型与定义的类型不符，会报警告。
@ServerName   // 服务端字段名，前后端字段名不一致时可以用这个来声明字段对应到服务端的哪个字段。
```

例如：

```javascript
import {
    SRNModel,
    Unit,
    UnitType,
    Check,
    CheckType,
    ServerName
} from '@souche-f2e/srn-framework';
import { observable,computed } from 'mobx';

class CarModel extends SRNModel {
    /**
     * 价格
     * @type {number}
     */
    @observable
    @Check(CheckType.Number)
    @Unit(UnitType.PRICE_UNIT_WY)
    price = 0;

    /**
     * 里程
     * @type {number}
     */
    @observable
    @Check(CheckType.Number)
    @Unit(UnitType.MILEAGE_UNIT_KM)
    mileage = 0;

    /**
     * 标题
     * @type {string}
     */
    @observable
    @Check(CheckType.String)
    @ServerName('model')
    title = '';

    /**
     * 卖家名
     * @type {string}
     */
    @observable
    @Check(CheckType.String)
    @ServerName('seller_name')
    sellerName = '';
}

export default  CarModel;
```

## SRNNative 原生组件库

SRNNative 是 srn-native 库的集成版，功能完全一样。

文档：http://fedoc.sqaproxy.souche.com/#/srn_native/srn_native

