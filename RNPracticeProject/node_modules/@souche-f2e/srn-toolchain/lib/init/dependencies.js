'use strict';

const execSync = require('child_process').execSync;

const chalk = require('chalk');

module.exports = function (done) {
    const registry = 'http://registry.npm.souche-inc.com';

    const dependencies = {
        /* dependencies */
        '@souche-f2e/srn-util': '',
        '@souche-f2e/srn-native': '',
        '@souche-f2e/srn-navigator': '',
        mobx: '3.1.0',
        'mobx-react': '4.1.8',
        fbemitter: '2.1.1'
    };

    if (process.env.SRN_TEMPLATE === 'v1') {
        dependencies['@souche-f2e/srn'] = '';
    } else {
        dependencies['@souche-f2e/srn-framework'] = '';
        dependencies['@souche-ui/srn-ui'] = '';
    }

    const devDependencies = {
        /* custom eslint */

        /* eslint */
        eslint: '3',
        '@souche-f2e/react-native': '0.43.4',
        'eslint-plugin-react': '6',
        'eslint-plugin-react-native': '2',

        /* babel */
        'babel-eslint': '',
        'babel-plugin-transform-decorators-legacy': '',
        'babel-preset-react-native-stage-0': '',

        /* react */
        'react-native-cli': '2.0.1'
    };

    try {
        /* install dependencies */
        // eslint-disable-next-line
        for (let key in dependencies) {
            if (dependencies.hasOwnProperty(key)) {
                const dep = dependencies[key] ? `${key}@${dependencies[key]}` : key;
                execSync(`npm install -S -E ${dep} --registry=${registry}`);
            }
        }

        /* install devDependencies */
        // eslint-disable-next-line
        for (let key in devDependencies) {
            if (devDependencies.hasOwnProperty(key)) {
                const dep = devDependencies[key] ? `${key}@${devDependencies[key]}` : key;
                execSync(`npm install -D -E ${dep} --registry=${registry}`);
            }
        }

        // execSync(`npm install -D -E @souche-f2e/react-native@0.39.2 --registry=${registry}`);
    } catch (e) {
        console.log(chalk.red('Error: Install npm dependencies fail'), e.stack);
    }

    if (done) {
        // eslint-disable-next-line
        done();
    }
};
