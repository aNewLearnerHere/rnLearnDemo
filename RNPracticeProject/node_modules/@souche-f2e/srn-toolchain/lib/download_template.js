'use strict';

const path = require('path');
const execSync = require('child_process').execSync;

const shell = require('shelljs');
const chalk = require('chalk');

const globalData = require('./global_data');

const handleTemplate = {
    /**
     * 下载模版，移动 example 文件夹，删除 .git
     */
    run: function (done) {
        shell.rm('-rf', globalData.RN_TEMPLATE_FOLDER);     // 如果下载过 template，那么删除掉之前下载过的

        let template = 'git@git.souche-inc.com:srn-core/srn-template.git';      // v2 template

        if (process.env.RN_TEMPLATE === 'v1') {
            template = 'git@git.souche-inc.com:srn-core/module-template.git';
        }

        try {
            // eslint-disable-next-line
            execSync(`git clone ${template} "${globalData.RN_TEMPLATE_FOLDER}" --depth=1`, { stdio: 'ignore' });
        } catch (e) {
            console.log(chalk.red('Error: Download module-template Fail\n'));
        }

        shell.rm('-rf', path.resolve(globalData.PROJECT_ROOT, './examples/'));
        shell.rm('-rf', path.resolve(globalData.RN_TEMPLATE_FOLDER, './.git/'));

        if (done) {
            return done();
        }
    }
};

module.exports = handleTemplate;
